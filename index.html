<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Balanced Student Group Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.3/css/all.min.css" xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLMDJc5fS5Wp6FzHnCgVf7o/Q6nK14QW6J5Nf27Wl42gO3K6bB1l5z5Fh6m6a4A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Nunito', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        .card {
            background-color: #f8fafc;
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
        }
        
        .input-field {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            transition: all 0.15s ease-in-out;
        }
        
        .btn-primary {
            background-color: #10b981;
            color: white;
            font-weight: 800;
            font-size: 1.5rem;
            padding: 1rem 2rem;
            border-radius: 0.75rem;
            transition: all 0.2s ease;
            box-shadow: 0 8px 20px -6px rgba(16, 185, 129, 0.7);
            transform: scale(1);
        }
        .btn-primary:hover {
            background-color: #059669;
            transform: scale(1.01);
        }
        
        .btn-secondary {
            background-color: #e5e7eb;
            color: #1f2937;
            font-weight: 600;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: all 0.15s ease;
        }
        .btn-secondary:hover {
            background-color: #d1d5db;
        }

        .btn-export {
            background-color: #4b5563;
            color: white;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: all 0.15s ease;
        }
        .btn-export:hover {
            background-color: #374151;
        }

        .btn-pdf { 
            background-color: #4f46e5;
            color: white;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: all 0.15s ease;
        }
        .btn-pdf:hover {
            background-color: #4338ca;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #fff;
            border-radius: 50%;
            width: 1.5rem;
            height: 1.5rem;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .dropdown {
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            appearance: none;
            background-color: white;
            padding-right: 2rem;
        }
    </style>
</head>
<body class="bg-white min-h-screen p-4 sm:p-8 font-sans">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script type="module">
        let students = [];
        let mustBeTogether = []; 
        let conflictConstraints = []; 
        let lastGeneratedGroups = []; 

        const ACADEMIC_SCORES = { 'A': 5, 'B': 4, 'C': 3, 'D': 2, 'E': 1 };
        const BEHAVIOR_OPTIONS = [1, 2, 3, 4, 5]; 
        const ACADEMIC_OPTIONS = ['A', 'B', 'C', 'D', 'E'];
        const ROLE_OPTIONS = ['Other', 'Leader', 'Bully', 'Victim'];

        const generateId = () => Math.random().toString(36).substring(2, 9);
        
        const renderBehaviorDropdown = (studentId, currentVal) => {
            let options = BEHAVIOR_OPTIONS.map(val => 
                `<option value="${val}" ${currentVal == val ? 'selected' : ''}>${val}</option>`
            ).join('');
            return `<select onchange="window.updateStudent('${studentId}', 'behavior', this.value)" class="dropdown">${options}</select>`;
        };

        const renderAcademicDropdown = (studentId, currentVal) => {
            let options = ACADEMIC_OPTIONS.map(val => 
                `<option value="${val}" ${currentVal === val ? 'selected' : ''}>${val}</option>`
            ).join('');
            return `<select onchange="window.updateStudent('${studentId}', 'academics', this.value)" class="dropdown">${options}</select>`;
        };
        
        const renderRoleDropdown = (studentId, currentVal) => {
            let options = ROLE_OPTIONS.map(val => 
                `<option value="${val}" ${currentVal === val ? 'selected' : ''}>${val}</option>`
            ).join('');
            return `<select onchange="window.updateStudent('${studentId}', 'role', this.value)" class="dropdown">${options}</select>`;
        };
        
        window.renderStudentList = () => {
            const listContainer = document.getElementById('student-list');
            listContainer.innerHTML = '';
            
            const emptyMsg = document.getElementById('empty-roster-message');
            students.length === 0 ? emptyMsg.classList.remove('hidden') : emptyMsg.classList.add('hidden');

            students.forEach(student => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-slate-100'; 
                row.innerHTML = `
                    <td class="p-3 whitespace-nowrap">
                        <input type="text" value="${student.name}" onchange="window.updateStudent('${student.id}', 'name', this.value)" class="input-field max-w-40 text-sm font-medium text-gray-900"/>
                    </td>
                    <td class="p-3 whitespace-nowrap">
                        ${renderBehaviorDropdown(student.id, student.behavior)}
                    </td>
                    <td class="p-3 whitespace-nowrap">
                        ${renderAcademicDropdown(student.id, student.academics)}
                    </td>
                    <td class="p-3 whitespace-nowrap">
                        ${renderRoleDropdown(student.id, student.role)}
                    </td>
                    <td class="p-3 whitespace-nowrap text-sm font-medium">
                        <button onclick="window.removeStudent('${student.id}')" class="text-red-600 hover:text-red-900 p-1 rounded-full hover:bg-red-50 transition">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                        </button>
                    </td>
                `;
                listContainer.appendChild(row);
            });
            window.renderConstraintSelectors();
        };

        const renderStudentSelector = (currentStudentId, constraintIndex, studentIndexInConstraint, type) => {
            const studentOptions = students.map(s => 
                `<option value="${s.id}" ${s.id === currentStudentId ? 'selected' : ''}>${s.name}</option>`
            ).join('');
            const onChangeHandler = `window.updateConstraint(${constraintIndex}, ${studentIndexInConstraint}, '${type}', this.value)`;
            return `
                <select class="dropdown w-full" onchange="${onChangeHandler}">
                    <option value="">-- Select Student --</option>
                    ${studentOptions}
                </select>
            `;
        };
        
        window.renderConstraintSelectors = () => {
            const togetherList = document.getElementById('must-be-together-list');
            const conflictList = document.getElementById('conflict-constraints-list');
            
            togetherList.innerHTML = mustBeTogether.map((constraint, index) => 
                renderConstraintRow(constraint, index, 'together')
            ).join('');

            conflictList.innerHTML = conflictConstraints.map((constraint, index) => 
                renderConstraintRow(constraint, index, 'conflict')
            ).join('');
        };

        const renderConstraintRow = (constraint, index, type) => {
            const relationText = type === 'together' ? 'and' : 'must not be with'; 
            
            return `
                <div class="flex items-center space-x-2 p-3 bg-white rounded-lg border">
                    <div class="flex-grow space-y-1">
                        ${renderStudentSelector(constraint[0], index, 0, type)}
                        <span class="text-xs text-gray-500 block text-center">${relationText}</span>
                        ${renderStudentSelector(constraint[1], index, 1, type)}
                    </div>
                    <button onclick="window.removeConstraint(${index}, '${type}')" class="text-red-500 hover:text-red-700 p-1 transition" title="Remove constraint">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                </div>
            `;
        };


        window.addStudentRow = () => {
            const newStudent = {
                id: generateId(),
                name: `Student ${students.length + 1}`,
                behavior: 3,
                academics: 'C',
                role: 'Other'
            };
            students.push(newStudent);
            window.renderStudentList();
        };

        window.updateStudent = (id, key, value) => {
            const student = students.find(s => s.id === id);
            if (student) {
                student[key] = key === 'behavior' ? parseInt(value) : value;
                if (key === 'name') {
                    window.renderStudentList();
                }
            }
        };

        window.removeStudent = (id) => {
            students = students.filter(s => s.id !== id);
            
            mustBeTogether = mustBeTogether.filter(c => !c.includes(id));
            conflictConstraints = conflictConstraints.filter(c => !c.includes(id));

            window.renderStudentList();
        };
        
        window.addConstraint = (type) => {
            const constraintList = type === 'together' ? mustBeTogether : conflictConstraints;
            constraintList.push(["", ""]); 
            window.renderConstraintSelectors();
        };

        window.updateConstraint = (constraintIndex, studentIndexInConstraint, type, studentId) => {
            const listToUpdate = type === 'together' ? mustBeTogether : conflictConstraints;
            if (listToUpdate[constraintIndex]) {
                listToUpdate[constraintIndex][studentIndexInConstraint] = studentId;
            }
        };

        window.removeConstraint = (index, type) => {
            if (type === 'together') {
                mustBeTogether.splice(index, 1);
            } else {
                conflictConstraints.splice(index, 1);
            }
            window.renderConstraintSelectors();
        };

        const getAcademicScore = (grade) => ACADEMIC_SCORES[grade] || 0;

        const hasConflict = (student, group, allConstraints) => {
            const studentId = student.id;
            const studentConflicts = allConstraints.filter(c => c.includes(studentId));

            for (const conflictPair of studentConflicts) {
                const otherId = conflictPair.find(id => id !== studentId);
                if (group.some(s => s.id === otherId)) {
                    return true;
                }
            }

            const isNewStudentBully = student.role === 'Bully';
            const isNewStudentVictim = student.role === 'Victim';

            for (const groupMember of group) {
                const groupMemberRole = groupMember.role;

                if ((isNewStudentBully && groupMemberRole === 'Victim') ||
                    (isNewStudentVictim && groupMemberRole === 'Bully')) {
                    return true;
                }
            }

            return false;
        };
        
        const calculateGroupScore = (group) => {
            let totalBehavior = 0;
            let totalAcademic = 0;
            let leaderCount = 0;

            for (const student of group) {
                totalBehavior += Number(student.behavior);
                totalAcademic += Number(student.academicScore);
                if (student.role === 'Leader') {
                    leaderCount++;
                }
            }
            return { totalBehavior, totalAcademic, leaderCount, totalScore: totalBehavior + totalAcademic, size: group.length };
        };

        window.generateGroups = () => {
            const numGroups = parseInt(document.getElementById('num-groups').value);
            const messageBox = document.getElementById('message-box');
            messageBox.style.display = 'none';

            if (students.length === 0 || numGroups <= 0 || numGroups > students.length) {
                window.showMessage("error", "Please check your inputs: add students and ensure the number of groups is valid.");
                return;
            }
            
            const generateButton = document.getElementById('generate-button');
            const originalHtml = generateButton.innerHTML;
            generateButton.disabled = true;
            generateButton.innerHTML = '<div class="spinner"></div><span class="ml-2">Generating...</span>';
            
            setTimeout(() => {
                const allStudents = students.map(s => ({
                    ...s,
                    behavior: parseInt(s.behavior),
                    academicScore: getAcademicScore(s.academics)
                }));
                
                const isValidConstraint = (c) => allStudents.some(s => s.id === c[0]) && allStudents.some(s => s.id === c[1]);
                const validMustBeTogether = mustBeTogether.filter(isValidConstraint);
                const validConflictConstraints = conflictConstraints.filter(isValidConstraint);

                let groups = Array.from({ length: numGroups }, () => []);
                let assignedStudentIds = new Set();
                let success = true;

                for (const constraint of validMustBeTogether) {
                    const [id1, id2] = constraint;
                    const s1 = allStudents.find(s => s.id === id1);
                    const s2 = allStudents.find(s => s.id === id2);

                    if (assignedStudentIds.has(id1) || assignedStudentIds.has(id2)) {
                        continue; 
                    }

                    if (hasConflict(s1, [s2], validConflictConstraints)) {
                         window.showMessage("error", `Cannot satisfy 'Must Be Together' constraint: ${s1.name} and ${s2.name} have an inherent conflict.`);
                         success = false;
                         break;
                    }
                    
                    let bestGroupIndex = -1;
                    let minSize = Infinity;

                    for (let i = 0; i < numGroups; i++) {
                        const conflicts1 = hasConflict(s1, groups[i], validConflictConstraints);
                        const conflicts2 = hasConflict(s2, groups[i], validConflictConstraints);

                        if (!conflicts1 && !conflicts2) {
                            if (groups[i].length < minSize) {
                                minSize = groups[i].length;
                                bestGroupIndex = i;
                            }
                        }
                    }

                    if (bestGroupIndex !== -1) {
                        groups[bestGroupIndex].push(s1, s2);
                        assignedStudentIds.add(id1);
                        assignedStudentIds.add(id2);
                    } else {
                        window.showMessage("error", `Cannot satisfy a 'Must Be Together' constraint for ${s1.name} and ${s2.name} due to conflicts.`);
                        success = false;
                        break;
                    }
                }
                
                if (success) {
                    let unassignedStudents = allStudents.filter(s => !assignedStudentIds.has(s.id));
                    
                    unassignedStudents.sort((a, b) => {
                        const roleOrder = (role) => {
                            if (role === 'Leader') return 3;
                            if (role === 'Bully' || role === 'Victim') return 2;
                            return 1;
                        };
                        if (roleOrder(a.role) !== roleOrder(b.role)) return roleOrder(b.role) - roleOrder(a.role);
                        
                        return (b.behavior + b.academicScore) - (a.behavior + a.academicScore);
                    });

                    const totalScoreUnassigned = unassignedStudents.reduce((sum, s) => sum + s.behavior + s.academicScore, 0);
                    const remainingSlots = allStudents.length - assignedStudentIds.size;
                    const targetAvgScore = remainingSlots > 0 ? totalScoreUnassigned / numGroups : 0;
                    
                    for (const student of unassignedStudents) {
                        let bestGroupIndex = -1;
                        let minGroupSize = Infinity;
                        let minScoreVariance = Infinity;
                        
                        for (let i = 0; i < numGroups; i++) {
                            const currentGroup = groups[i];
                            
                            if (hasConflict(student, currentGroup, validConflictConstraints)) {
                                continue;
                            }

                            const tentativeGroup = [...currentGroup, student];
                            const tentativeScore = calculateGroupScore(tentativeGroup);
                            
                            const groupSize = tentativeGroup.length;
                            const scoreDifference = Math.abs(tentativeScore.totalScore - (targetAvgScore * groupSize)); 
                            
                            if (groupSize < minGroupSize) {
                                bestGroupIndex = i;
                                minGroupSize = groupSize;
                                minScoreVariance = scoreDifference;
                            } 
                            else if (groupSize === minGroupSize && scoreDifference < minScoreVariance) {
                                bestGroupIndex = i;
                                minScoreVariance = scoreDifference;
                            } 
                            else if (groupSize === minGroupSize && scoreDifference === minScoreVariance && student.role === 'Leader') {
                                if (bestGroupIndex !== -1) {
                                    const currentBestGroupStats = calculateGroupScore(groups[bestGroupIndex]);
                                    if (tentativeScore.leaderCount < currentBestGroupStats.leaderCount) {
                                        bestGroupIndex = i;
                                    }
                                }
                            }
                        }

                        if (bestGroupIndex !== -1) {
                            groups[bestGroupIndex].push(student);
                            assignedStudentIds.add(student.id);
                        } else {
                            window.showMessage("error", `Could not place student ${student.name} into any group.`);
                            success = false;
                            break;
                        }
                    }
                }

                generateButton.disabled = false;
                generateButton.innerHTML = originalHtml;

                if (success) {
                    lastGeneratedGroups = groups;
                    window.renderGroupResults(groups);
                    window.showMessage("success", `Successfully generated ${numGroups} balanced groups.`);
                    
                } else {
                    lastGeneratedGroups = [];
                    document.getElementById('results-card').style.display = 'none';
                }
            }, 50); 
        };


        window.renderGroupResults = (groups) => {
            const resultsContainer = document.getElementById('group-results');
            resultsContainer.innerHTML = '';
            document.getElementById('results-card').style.display = 'block';

            groups.forEach((group, index) => {
                const { totalBehavior, totalAcademic, leaderCount } = calculateGroupScore(group);
                
                const groupElement = document.createElement('div');
                groupElement.className = 'bg-teal-50 p-4 rounded-lg border border-teal-200'; 
                groupElement.innerHTML = `
                    <h3 class="text-lg font-semibold text-teal-800 mb-2">Group ${index + 1} <span class="text-sm font-normal text-teal-600">(${group.length} students)</span></h3>
                    
                    <div class="flex flex-wrap gap-4 text-sm mb-3">
                        <div class="flex items-center text-gray-700">
                            <i class="fas fa-face-smile w-4 h-4 mr-1 text-green-500"></i>
                            Total Behavior Score: <span class="font-medium ml-1">${totalBehavior}</span>
                        </div>
                        <div class="flex items-center text-gray-700">
                            <i class="fas fa-book w-4 h-4 mr-1 text-yellow-500"></i>
                            Total Academic Score: <span class="font-medium ml-1">${totalAcademic}</span>
                        </div>
                        <div class="flex items-center text-gray-700">
                            <svg class="w-4 h-4 mr-1 text-purple-500" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path></svg>
                            Leaders: <span class="font-medium ml-1">${leaderCount}</span>
                        </div>
                    </div>

                    <ul class="list-disc pl-5 space-y-1 text-gray-800">
                        ${group.map(s => {
                            let roleText = '';
                            if (['Leader', 'Bully', 'Victim'].includes(s.role)) {
                                roleText = `<span class="text-xs ml-1 text-gray-600">(${s.role})</span>`;
                            }
                            
                            return `
                                <li class="text-sm">
                                    ${s.name} <span class="font-semibold text-teal-700">${s.behavior}${s.academics}</span>${roleText}
                                </li>
                            `;
                        }).join('')}
                    </ul>
                `;
                resultsContainer.appendChild(groupElement);
            });
        };

        window.showMessage = (type, message) => {
            const box = document.getElementById('message-box');
            box.textContent = message;
            box.className = 'p-3 rounded-lg text-sm font-medium transition duration-300'; 

            if (type === 'error') {
                box.classList.add('bg-red-100', 'border-red-500', 'text-red-800', 'border');
            } else if (type === 'success') {
                box.classList.add('bg-green-100', 'border-green-500', 'text-green-800', 'border');
            } else if (type === 'warning') {
                box.classList.add('bg-yellow-100', 'border-yellow-500', 'text-yellow-800', 'border');
            }
            box.style.display = 'block';
        };

        window.exportToCSV = () => {
            if (lastGeneratedGroups.length === 0) {
                window.showMessage('warning', 'Please generate groups first before attempting to export.');
                return;
            }

            let csvContent = "Group,Name,Behavior Score,Academic Grade,Role\n";

            lastGeneratedGroups.forEach((group, groupIndex) => {
                const groupNumber = `Group ${groupIndex + 1}`;
                group.forEach(student => {
                    const name = student.name.replace(/"/g, '""');
                    csvContent += `"${groupNumber}","${name}",${student.behavior},${student.academics},"${student.role}"\n`;
                });
            });

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', 'student_groups.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            window.showMessage('success', 'Groups successfully exported to CSV.');
        };
        
        window.exportToPDF = async () => {
            if (lastGeneratedGroups.length === 0) {
                window.showMessage('warning', 'Please generate groups first before attempting to export.');
                return;
            }

            const resultsCard = document.getElementById('results-card');
            const exportActions = document.getElementById('export-actions-container'); 
            const pdfButton = document.getElementById('pdf-export-content');
            
            pdfButton.innerHTML = '<div class="spinner"></div><span class="ml-2">Generating PDF...</span>';
            if (exportActions) exportActions.style.pointerEvents = 'none';

            try {
                const JsPDF = window.jspdf.jsPDF; 

                const exportButtons = document.getElementById('export-actions-container');
                exportButtons.classList.add('hidden');

                const canvas = await html2canvas(resultsCard, {
                    scale: 2, 
                    logging: false,
                    allowTaint: true,
                    useCORS: true,
                    backgroundColor: '#ffffff' 
                });

                exportButtons.classList.remove('hidden');

                const imgData = canvas.toDataURL('image/png');
                const imgWidth = 200; 
                const pageHeight = 295; 
                const imgHeight = canvas.height * imgWidth / canvas.width;
                let heightLeft = imgHeight;
                let position = 0;

                const pdf = new JsPDF('p', 'mm', 'a4');

                pdf.addImage(imgData, 'PNG', 5, position + 5, imgWidth - 10, imgHeight);
                heightLeft -= pageHeight;

                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 5, position + 5, imgWidth - 10, imgHeight);
                    heightLeft -= pageHeight;
                }

                pdf.save('student_groups.pdf');

                window.showMessage('success', 'Groups successfully exported to PDF.');
            } catch (error) {
                console.error("PDF generation failed:", error);
                window.showMessage('error', 'Failed to generate PDF.');
            } finally {
                pdfButton.innerHTML = '<i class="fas fa-file-pdf mr-2"></i>Export to PDF';
                if (exportActions) exportActions.style.pointerEvents = 'auto';
            }
        };

    </script>
    

    <div class="max-w-7xl mx-auto space-y-8">
        <header class="text-center py-6 bg-teal-600 rounded-xl shadow-lg">
            <h1 class="text-3xl sm:text-4xl font-extrabold text-white">üóÇÔ∏è Balanced Student Group Generator</h1>
        </header>

        <div id="message-box" class="hidden p-3 rounded-lg text-sm font-medium transition duration-300"></div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-2 card">
                <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-user-check mr-2 text-teal-600"></i>
                    Student Roster
                </h2>

                <div class="overflow-x-auto mb-4">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-slate-100">
                            <tr>
                                <th class="p-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Name</th>
                                <th class="p-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Behavior (1-5)</th>
                                <th class="p-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Academics (A-E)</th>
                                <th class="p-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Role</th>
                                <th class="p-3"></th>
                            </tr>
                        </thead>
                        <tbody id="student-list" class="bg-white divide-y divide-gray-200">
                        </tbody>
                    </table>
                </div>
                
                <p id="empty-roster-message" class="text-center text-gray-500 py-8 hidden">
                    No students added yet. Click "Add Student" to begin building your roster.
                </p>

                <div class="flex flex-wrap justify-between items-center mt-4">
                    <button onclick="window.addStudentRow()" class="btn-secondary flex items-center">
                        <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                        Add Student
                    </button>
                </div>
            </div>

            <div class="lg:col-span-1 space-y-6">
                
                <div class="card">
                    <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-handshake mr-2 text-teal-600"></i>
                        Must Be Together
                    </h2>
                    <p class="text-sm text-gray-600 mb-3">Select students who must be in the same group.</p>
                    <div id="must-be-together-list" class="space-y-3 mb-4">
                    </div>
                    <button onclick="window.addConstraint('together')" class="btn-secondary text-sm">
                        + Add Together Constraint
                    </button>
                </div>

                <div class="card">
                    <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-ban mr-2 text-teal-600"></i>
                        Must Be Separated
                    </h2>
                    <p class="text-sm text-gray-600 mb-3">
                        Select students who must not be in the same group. 
                        <span class="font-semibold text-red-500">(Bullies and Victims will also be separated automatically.)</span>
                    </p>
                    <div id="conflict-constraints-list" class="space-y-3 mb-4">
                    </div>
                    <button onclick="window.addConstraint('conflict')" class="btn-secondary text-sm">
                        + Add Separation Constraint
                    </button>
                </div>
                
                <div class="card">
                    <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-cogs mr-2 text-teal-600"></i>
                        Group Settings
                    </h2>
                    <label for="num-groups" class="block text-sm font-medium text-gray-700 mb-1">Number of Groups to Create</label>
                    <input type="number" id="num-groups" value="4" min="1" class="input-field mb-4" />

                    <label class="block text-2xl font-extrabold text-gray-700 mb-3">GENERATE GROUPS</label>
                    
                    <button id="generate-button" onclick="window.generateGroups()" class="btn-primary w-full flex items-center justify-center">
                        <i class="fas fa-sitemap mr-3"></i>
                        GENERATE GROUPS NOW
                    </button>
                </div>
                
            </div>
        </div>

        <div id="results-card" class="card mt-8 hidden">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-3xl font-bold text-teal-700 flex items-center">
                    <i class="fas fa-users-gear mr-2"></i> Final Grouping Results
                </h2>
                <div id="export-actions-container" class="flex space-x-2 export-actions">
                    <button onclick="window.exportToCSV()" class="btn-export flex items-center">
                        <i class="fas fa-file-csv mr-2"></i> Export to CSV
                    </button>
                    <button onclick="window.exportToPDF()" class="btn-pdf flex items-center" id="pdf-export-content">
                        <i class="fas fa-file-pdf mr-2"></i> Export to PDF
                    </button>
                </div>
            </div>

            <div id="group-results" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
            </div>
        </div>
    </div>
    
    <script type="module">
        window.addEventListener('DOMContentLoaded', () => {
            window.addStudentRow();
            window.addStudentRow();
            window.addStudentRow();
            window.addStudentRow();
            window.addStudentRow();
            window.addStudentRow();
            window.renderStudentList();
        });
    </script>
</body>
</html>
